var locale,path,page,baseurl=window.location.origin,mypos={},maps={},airport_marker={},navaid_marker={};!function(a){var t=()=>self.crypto.randomUUID(),e=function(e,n={}){n.token=t(),a.ajax({url:baseurl+"/inc/api/"+e+".php",type:"post",data:n,success:function(t){let e=JSON.parse(t);page=e.page,document.title=s(e.title),a("#content").attr("page",page).html(e.content),"searchtext"in e&&(a('[data-form="search"] input').val(e.searchtext),document.title+=": "+e.searchtext),m(),o()}})},o=function(){a("[data-map]").each((function(){let e=t(),o=JSON.parse(window.atob(a(this).attr("data-map"))),i=o.lat||mypos.lat||0,c=o.lon||mypos.lon||0;a(this).attr("id",e).removeAttr("data-map"),maps[e]=L.map(e,{center:[i,c],zoom:o.zoom||12,maxBounds:L.latLngBounds(L.latLng(-90,-180),L.latLng(90,180)),maxBoundsViscosity:1,preferCanvas:!0,scrollWheelZoom:o.wheelZoom||!1}),navaid_marker[e]=L.layerGroup().addTo(maps[e]),airport_marker[e]=L.layerGroup().addTo(maps[e]),L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{minZoom:o.minZoom||4,maxZoom:o.maxZoom||15,attribution:s("Data by")+' <a href="https://openstreetmap.org">OSM</a> | '+s("Â© %YEAR%")+' <a href="'+baseurl+'">airportmap.de</a>'}).addTo(maps[e]),L.control.scale().addTo(maps[e]),n(e),maps[e].on("moveend",(function(){r(e,maps[e])})),r(e,maps[e])}))},n=function(a){"lat"in mypos&&"lon"in mypos&&L.marker(L.latLng(mypos.lat,mypos.lon),{icon:L.divIcon({iconSize:"100px",iconAnchor:[10,10],className:"mypos",html:'<div class="pic"></div>'})}).addTo(maps[a])},r=function(e,o){let n=o.getBounds();a.ajax({url:baseurl+"/inc/api/_marker.php",type:"post",data:{token:t(),closed:!0,limit:500,zoom:o.getZoom(),bounds:{lat:[n.getNorth(),n.getSouth()],lon:[n.getEast(),n.getWest()]}},success:function(a){let t=JSON.parse(a);navaid_marker[e].clearLayers(),airport_marker[e].clearLayers(),Object.values(t.navaids).forEach((function(a){navaid_marker[e].addLayer(L.marker(L.latLng(a.lat,a.lon),{icon:L.divIcon({iconSize:"100px",iconAnchor:[10,10],className:"navaid-"+a.type,html:'<div class="pic"></div><div class="info">'+(a.frequency>1e3?l(a.frequency/1e3,{minimumFractionDigits:1})+" MHz":l(a.frequency)+" kHz")+"</div>"})}).on("click",(function(a){c(a,e,o)})))})),Object.values(t.airports).forEach((function(a){airport_marker[e].addLayer(L.marker(L.latLng(a.lat,a.lon),{icon:L.divIcon({iconSize:"100px",iconAnchor:[10,10],className:"type-"+a.type+" restrict-"+a.restriction,html:'<div class="pic"></div><div class="info">'+a.ICAO+"</div>"})}).on("click",(function(a){i(a,e,o)})))}))}})},i=function(a,t,e){e.setView(a.target.getLatLng())},c=function(a,t,e){e.setView(a.target.getLatLng())},s=function(a=""){return a.replaceAll("%YEAR%",(new Date).getFullYear())},l=function(a,t={}){return new Intl.NumberFormat(locale,t).format(a)},m=function(){a("[data-i18n]").each((function(){a(this).html(s(a(this).attr("data-i18n"))).removeAttr("data-i18n")})),a("[data-title]").each((function(){a(this).attr("title",s(a(this).attr("data-title"))).removeAttr("data-title")})),a("[data-placeholder]").each((function(){a(this).attr("placeholder",s(a(this).attr("data-placeholder"))).removeAttr("data-placeholder")})),a("[data-number]").each((function(){a(this).html(l(a(this).attr("data-number"))).removeAttr("data-number")})),a("[data-href]").each((function(){a(this).attr("href",baseurl+"/"+a(this).attr("data-href")).removeAttr("data-href")})),a("[data-nav]").removeClass("active"),a('[data-nav="'+page+'"]').addClass("active"),a('[data-action="select-language"]').each((function(){a(this).val(locale)}))};a(document).on("submit","[data-form]",(function(t){switch(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),a(this).attr("data-form")){case"search":location.href=baseurl+"/search/"+a(this).find('[name="searchtext"]').val().trim();break}return!1})),a(document).on("change","[data-action]",(function(t){switch(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),a(this).attr("data-action")){case"select-language":a.cookie("locale",a(this).val()),location.reload();break}})),a(document).ready((function(){a.cookie.defaults={path:"/",expires:365},navigator.geolocation.getCurrentPosition((function(a){mypos={lat:a.coords.latitude,lon:a.coords.longitude}})),locale=a.cookie("locale")||"en-US",a("html").attr("lang",locale),function(){switch((path=window.location.pathname.split("/").filter((a=>a)))[0]){case"search":e("search",{searchtext:path[1]});break;default:e("map");break}}()}))}(jQuery);