var locale,path,page,baseurl=window.location.origin,mypos={},maps={},markers={};!function(t){var a=()=>self.crypto.randomUUID(),e=function(e,r={}){r.token=a(),t.ajax({url:baseurl+"/inc/api/"+e+".php",type:"post",data:r,success:function(a){let e=JSON.parse(a);page=e.page,document.title=n(e.title),t("#content").attr("page",page).html(e.content),i(),o()}})},o=function(){t("[data-map]").each((function(){let e=a(),o=JSON.parse(window.atob(t(this).attr("data-map"))),i=o.lat||mypos.lat||0,l=o.lon||mypos.lon||0;t(this).attr("id",e).removeAttr("data-map"),maps[e]=L.map(e,{center:[i,l],zoom:o.zoom||12,preferCanvas:!0,scrollWheelZoom:o.wheelZoom||!1}),markers[e]=L.layerGroup().addTo(maps[e]),L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{minZoom:o.minZoom||4,maxZoom:o.maxZoom||15,attribution:n("Data by")+' <a href="https://openstreetmap.org">OSM</a> | '+n("Â© %YEAR%")+' <a href="'+baseurl+'">airportmap.de</a>'}).addTo(maps[e]),L.control.scale().addTo(maps[e]),maps[e].on("moveend",(function(){r(e,maps[e])})),r(e,maps[e])}))},r=function(e,o){let r=o.getBounds();t.ajax({url:baseurl+"/inc/api/_marker.php",type:"post",data:{token:a(),zoom:o.getZoom(),bounds:{lat:[r.getNorth(),r.getSouth()],lon:[r.getEast(),r.getWest()]}},success:function(t){let a=JSON.parse(t);markers[e].clearLayers(),Object.values(a.airports).forEach((function(t){markers[e].addLayer(L.marker(L.latLng(t.lat,t.lon)))}))}})},n=function(t=""){return t.replaceAll("%YEAR%",(new Date).getFullYear())},i=function(){t("[data-i18n]").each((function(){t(this).html(n(t(this).attr("data-i18n"))).removeAttr("data-i18n")})),t("[data-title]").each((function(){t(this).attr("title",n(t(this).attr("data-title"))).removeAttr("data-title")})),t("[data-placeholder]").each((function(){t(this).attr("placeholder",n(t(this).attr("data-placeholder"))).removeAttr("data-placeholder")})),t("[data-number]").each((function(){t(this).html(function(t,a={}){return new Intl.NumberFormat(locale,a).format(t)}(t(this).attr("data-number"))).removeAttr("data-number")})),t("[data-href]").each((function(){t(this).attr("href",baseurl+"/"+t(this).attr("data-href")).removeAttr("data-href")})),t("[data-nav]").removeClass("active"),t('[data-nav="'+page+'"]').addClass("active")};t(document).on("submit","[data-form]",(function(a){switch(a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),t(this).attr("data-form")){case"search":location.href=baseurl+"/search/"+t(this).find('[name="searchtext"]').val();break}return!1})),t(document).ready((function(){navigator.geolocation.getCurrentPosition((function(t){mypos={lat:t.coords.latitude,lon:t.coords.longitude}})),locale=t.cookie("locale")||"en-US",t("html").attr("lang",locale),function(){switch((path=window.location.pathname.split("/").filter((t=>t)))[0]){default:e("map");break}}()}))}(jQuery);