var locale,path,page,__res,baseurl=window.location.origin,mypos={},maps={},airport_marker={},navaid_marker={};!function(a){Math.toRad=a=>a*Math.PI/180,Math.toDeg=a=>180*a/Math.PI;var t=()=>self.crypto.randomUUID(),e=a=>{a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation()},o=function(e,o={}){o.token=t(),o.referrer=document.referrer,a.ajax({url:baseurl+"/inc/api/"+e+".php",type:"post",data:o,success:function(t){"redirect_to"in(__res=JSON.parse(t))?location.href=baseurl+"/"+__res.redirect_to:(page=__res.page,document.title=c(__res.title),a("#content").attr("page",page).html(__res.content),"searchtext"in __res&&(a('[data-form="search"] input').val(__res.searchtext),document.title+=": "+__res.searchtext),p(),r())}})},r=function(){a("[data-map]").each((function(){let e=t(),o=JSON.parse(window.atob(a(this).attr("data-map"))),r=o.lat||mypos.lat||0,s=o.lon||mypos.lon||0;a(this).attr("id",e).removeAttr("data-map"),maps[e]=L.map(e,{center:[r,s],zoom:o.zoom||12,maxBounds:L.latLngBounds(L.latLng(-90,-180),L.latLng(90,180)),maxBoundsViscosity:1,preferCanvas:!0,scrollWheelZoom:o.wheelZoom||!1}),navaid_marker[e]=L.layerGroup().addTo(maps[e]),airport_marker[e]=L.layerGroup().addTo(maps[e]),L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{minZoom:o.minZoom||4,maxZoom:o.maxZoom||15,attribution:c("Data by")+' <a href="https://openstreetmap.org">OSM</a> | '+c("© %YEAR%")+' <a href="'+baseurl+'">airportmap.de</a>'}).addTo(maps[e]),L.control.scale().addTo(maps[e]),n(e),maps[e].on("moveend",(function(){i(e,maps[e])})),i(e,maps[e])}))},n=function(a){"lat"in mypos&&"lon"in mypos&&L.marker(L.latLng(mypos.lat,mypos.lon),{icon:L.divIcon({iconSize:"100px",iconAnchor:[10,10],className:"mypos",html:'<navicon class="invert"></navicon>'})}).addTo(maps[a])},i=function(e,o){let r=o.getBounds();a.ajax({url:baseurl+"/inc/api/_marker.php",type:"post",data:{token:t(),closed:!0,limit:500,zoom:o.getZoom(),bounds:{lat:[r.getNorth(),r.getSouth()],lon:[r.getEast(),r.getWest()]}},success:function(a){let t=JSON.parse(a);navaid_marker[e].clearLayers(),airport_marker[e].clearLayers(),Object.values(t.navaids).forEach((function(a){navaid_marker[e].addLayer(L.marker(L.latLng(a.lat,a.lon),{icon:L.divIcon({iconSize:"100px",iconAnchor:[10,10],className:"navaid-"+a.type,html:'<navicon class="invert"></navicon><div class="info">'+(a.frequency>1e3?d(a.frequency/1e3,{minimumFractionDigits:1})+" MHz":d(a.frequency)+" kHz")+"</div>"})}).on("click",(function(a){l(a,e,o)})))})),Object.values(t.airports).forEach((function(a){airport_marker[e].addLayer(L.marker(L.latLng(a.lat,a.lon),{icon:L.divIcon({iconSize:"100px",iconAnchor:[10,10],className:"type-"+a.type+" restrict-"+a.restriction,html:'<navicon class="invert"></navicon><div class="info">'+a.ICAO+"</div>"})}).on("click",(function(a){s(a,e,o)})))}))}})},s=function(a,t,e){e.setView(a.target.getLatLng())},l=function(a,t,e){e.setView(a.target.getLatLng())},c=(a="")=>a.toString().replaceAll("%YEAR%",(new Date).getFullYear()),d=(a,t={})=>new Intl.NumberFormat(locale,t).format(a),h=(a,t="lat")=>{let e=parseFloat(a),o=Math.abs(e),r=Math.floor(o),n=60*(o-r),i=Math.floor(n);return r+"°&#8239;"+i+"′&#8239;"+Math.floor(60*(n-i))+"″&#8239;"+{lat:e<0?"S":"N",lon:e<0?"W":"E"}[t]},p=function(){a("[data-i18n]").each((function(){a(this).html(c(a(this).attr("data-i18n"))).removeAttr("data-i18n")})),a("[data-title]").each((function(){a(this).attr("title",c(a(this).attr("data-title"))).removeAttr("data-title")})),a("[data-placeholder]").each((function(){a(this).attr("placeholder",c(a(this).attr("data-placeholder"))).removeAttr("data-placeholder")})),a("[data-number]").each((function(){a(this).html(d(a(this).attr("data-number"))).removeAttr("data-number")})),a("[data-date]").each((function(){a(this).html(((a,t={})=>{let e=new Date;return e.setTime(Date.parse(a)),e.toLocaleDateString(locale,t)})(a(this).attr("data-date"))).removeAttr("data-date")})),a("[data-lat]").each((function(){a(this).html(h(a(this).attr("data-lat"),"lat")).removeAttr("data-lat")})),a("[data-lon]").each((function(){a(this).html(h(a(this).attr("data-lon"),"lon")).removeAttr("data-lon")})),a("[data-alt]").each((function(){a(this).html(d(a(this).attr("data-alt"))+"&#8239;"+c("ft")).removeAttr("data-alt")})),a("[data-msl]").each((function(){a(this).html(d(Math.ceil(a(this).attr("data-msl")/3.281))+"&#8239;m&nbsp;"+c("MSL")).removeAttr("data-msl")})),a("[data-hdg-p1][data-hdg-p2]").each((function(){a(this).html(((a,t,e,o)=>{a=Math.toRad(parseFloat(a)),t=Math.toRad(parseFloat(t)),e=Math.toRad(parseFloat(e));let r=(o=Math.toRad(parseFloat(o)))-t,n=Math.cos(e)*Math.sin(r),i=Math.cos(a)*Math.sin(e)-Math.sin(a)*Math.cos(e)*Math.cos(r),s=(Math.toDeg(Math.atan2(n,i))+360)%360;return{heading:s,label:c(["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW","N"][Math.round(s/22.5)])}})(a(this).attr("data-hdg-p1").split(","),a(this).attr("data-hdg-p2").split(",")).label).removeAttr("data-hdg-p1 data-hdg-p2")})),a("[data-bc]").each((function(){a(this).html(((e,o=0)=>{let r=[];return e.split("::").forEach((function(e){if((label=e.substring(1)).length>0){let n=e.charAt(0);r.push('<a href="'+baseurl+"/"+{T:"continent",C:"country",R:"region",M:"municipality"}[n]+"/"+label.replaceAll(" ","_")+'">'+c(o&&"M"!=n?a.ajax({url:baseurl+"/inc/api/_bc.php",type:"post",data:{token:t(),type:n,ident:label},async:!1}).responseText:label)+"</a>")}})),r.join('<span class="divider">/</span>')})(a(this).attr("data-bc"),a(this).attr("data-bcdb")||0)).removeAttr("data-bc data-bcdb")})),a("[data-pagination]").each((function(){let t=JSON.parse(window.atob(a(this).attr("data-pagination")));a(this).html(((a=0,t=1)=>{if(a<=6)return"";let e=Math.ceil(a/24),o=baseurl+"/"+path.slice(0,2).join("/")+"/",r=[],n=0;return[1,Math.max(1,t-2),Math.max(1,t-1),t,Math.min(e,t+1),Math.min(e,t+2),e].filter(((a,t,e)=>e.indexOf(a)===t)).forEach((a=>{a>n+1&&r.push('<span class="dots"><span>…</span></span>'),r.push(a==t?'<span class="curr"><span>'+d(a)+"</span></span>":'<a class="link" href="'+o+a+'"><span>'+d(a)+"</span></a>"),n=a})),r.length<=1&&(r=[]),'<div class="pagelinks">'+r.join("")+'</div><div class="results"><b>'+d(a)+"</b>&nbsp;"+c("Results")+"</div>"})(t.results,t.page)).removeAttr("data-pagination")})),a("[data-href]").each((function(){a(this).attr("href",baseurl+"/"+a(this).attr("data-href").replaceAll(" ","_")).removeAttr("data-href")})),a("[data-nav]").removeClass("active"),a('[data-nav="'+page+'"]').addClass("active"),a("[data-tab]").removeClass("active"),a('[data-tab="'+(__res.tab||"_")+'"]').addClass("active"),a('[data-action="select-language"]').each((function(){a(this).val(locale)}))};a(document).on("submit","[data-form]",(function(t){switch(e(t),a(this).attr("data-form")){case"search":location.href=baseurl+"/search/"+a(this).find('[name="searchtext"]').val().trim().replaceAll(" ","_");break}return!1})),a(document).on("click","[data-action]",(function(t){switch(e(t),a(this).attr("data-action")){case"scroll-to-top":a("html, body").animate({scrollTop:0},"fast");break}})),a(document).on("change","[data-action]",(function(t){switch(e(t),a(this).attr("data-action")){case"select-language":a.cookie("locale",a(this).val()),location.reload();break}})),a(document).ready((function(){a.cookie.defaults={path:"/",expires:365},navigator.geolocation.getCurrentPosition((function(a){mypos={lat:a.coords.latitude,lon:a.coords.longitude}})),"serviceWorker"in navigator&&navigator.serviceWorker.register(baseurl+"/service-worker.min.js",{scope:"/"}),locale=a.cookie("locale")||"en-US",a("html").attr("lang",locale),function(){switch((path=window.location.pathname.split("/").filter((a=>a)))[0]){case"airport":o("airport",{airport:path[1]||"",tab:path[2]||"info"});break;case"search":o("search",{searchtext:(path[1]||"").replaceAll("_"," "),page:parseInt(path[2]||1)});break;default:o("map");break}}()})),a(document).scroll((function(){a(window).scrollTop()>200?a("body").addClass("scroll-to-top"):a("body").removeClass("scroll-to-top")}))}(jQuery);