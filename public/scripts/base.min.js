var locale,path,page,baseurl=window.location.origin,mypos={},maps={},airport_marker={},navaid_marker={};!function(t){var a=()=>self.crypto.randomUUID(),e=t=>{t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation()},o=function(e,o={}){o.token=a(),o.referrer=document.referrer,t.ajax({url:baseurl+"/inc/api/"+e+".php",type:"post",data:o,success:function(a){let e=JSON.parse(a);"redirect_to"in e?location.href=baseurl+"/"+e.redirect_to:(page=e.page,document.title=s(e.title),t("#content").attr("page",page).html(e.content),"searchtext"in e&&(t('[data-form="search"] input').val(e.searchtext),document.title+=": "+e.searchtext),h(),n())}})},n=function(){t("[data-map]").each((function(){let e=a(),o=JSON.parse(window.atob(t(this).attr("data-map"))),n=o.lat||mypos.lat||0,c=o.lon||mypos.lon||0;t(this).attr("id",e).removeAttr("data-map"),maps[e]=L.map(e,{center:[n,c],zoom:o.zoom||12,maxBounds:L.latLngBounds(L.latLng(-90,-180),L.latLng(90,180)),maxBoundsViscosity:1,preferCanvas:!0,scrollWheelZoom:o.wheelZoom||!1}),navaid_marker[e]=L.layerGroup().addTo(maps[e]),airport_marker[e]=L.layerGroup().addTo(maps[e]),L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{minZoom:o.minZoom||4,maxZoom:o.maxZoom||15,attribution:s("Data by")+' <a href="https://openstreetmap.org">OSM</a> | '+s("© %YEAR%")+' <a href="'+baseurl+'">airportmap.de</a>'}).addTo(maps[e]),L.control.scale().addTo(maps[e]),r(e),maps[e].on("moveend",(function(){i(e,maps[e])})),i(e,maps[e])}))},r=function(t){"lat"in mypos&&"lon"in mypos&&L.marker(L.latLng(mypos.lat,mypos.lon),{icon:L.divIcon({iconSize:"100px",iconAnchor:[10,10],className:"mypos",html:'<div class="pic"></div>'})}).addTo(maps[t])},i=function(e,o){let n=o.getBounds();t.ajax({url:baseurl+"/inc/api/_marker.php",type:"post",data:{token:a(),closed:!0,limit:500,zoom:o.getZoom(),bounds:{lat:[n.getNorth(),n.getSouth()],lon:[n.getEast(),n.getWest()]}},success:function(t){let a=JSON.parse(t);navaid_marker[e].clearLayers(),airport_marker[e].clearLayers(),Object.values(a.navaids).forEach((function(t){navaid_marker[e].addLayer(L.marker(L.latLng(t.lat,t.lon),{icon:L.divIcon({iconSize:"100px",iconAnchor:[10,10],className:"navaid-"+t.type,html:'<div class="pic"></div><div class="info">'+(t.frequency>1e3?d(t.frequency/1e3,{minimumFractionDigits:1})+" MHz":d(t.frequency)+" kHz")+"</div>"})}).on("click",(function(t){l(t,e,o)})))})),Object.values(a.airports).forEach((function(t){airport_marker[e].addLayer(L.marker(L.latLng(t.lat,t.lon),{icon:L.divIcon({iconSize:"100px",iconAnchor:[10,10],className:"type-"+t.type+" restrict-"+t.restriction,html:'<div class="pic"></div><div class="info">'+t.ICAO+"</div>"})}).on("click",(function(t){c(t,e,o)})))}))}})},c=function(t,a,e){e.setView(t.target.getLatLng())},l=function(t,a,e){e.setView(t.target.getLatLng())},s=function(t=""){return t.replaceAll("%YEAR%",(new Date).getFullYear())},d=function(t,a={}){return new Intl.NumberFormat(locale,a).format(t)},m=function(t,a="lat"){let e=parseFloat(t),o=Math.abs(e),n=Math.floor(o),r=60*(o-n),i=Math.floor(r);return n+"°&#8239;"+i+"′&#8239;"+Math.floor(60*(r-i))+"″&#8239;"+{lat:e<0?"S":"N",lon:e<0?"W":"E"}[a]},h=function(){t("[data-i18n]").each((function(){t(this).html(s(t(this).attr("data-i18n"))).removeAttr("data-i18n")})),t("[data-title]").each((function(){t(this).attr("title",s(t(this).attr("data-title"))).removeAttr("data-title")})),t("[data-placeholder]").each((function(){t(this).attr("placeholder",s(t(this).attr("data-placeholder"))).removeAttr("data-placeholder")})),t("[data-number]").each((function(){t(this).html(d(t(this).attr("data-number"))).removeAttr("data-number")})),t("[data-lat]").each((function(){t(this).html(m(t(this).attr("data-lat"),"lat")).removeAttr("data-lat")})),t("[data-lon]").each((function(){t(this).html(m(t(this).attr("data-lon"),"lon")).removeAttr("data-lon")})),t("[data-alt]").each((function(){t(this).html(d(t(this).attr("data-alt"))+"&#8239;"+s("ft")).removeAttr("data-alt")})),t("[data-msl]").each((function(){t(this).html(d(Math.ceil(t(this).attr("data-msl")/3.281))+"&#8239;m&nbsp;"+s("MSL")).removeAttr("data-msl")})),t("[data-bc]").each((function(){t(this).html(function(t){let a=[];return t.split("/").forEach((function(t){let e=t.substring(1);a.push('<a href="'+baseurl+"/"+{T:"continent",C:"country",R:"region",M:"municipality"}[t.charAt(0)]+"/"+e.replaceAll(" ","_")+'">'+s(e)+"</a>")})),a.join('<span class="divider">/</span>')}(t(this).attr("data-bc"))).removeAttr("data-bc")})),t("[data-href]").each((function(){t(this).attr("href",baseurl+"/"+t(this).attr("data-href").replaceAll(" ","_")).removeAttr("data-href")})),t("[data-nav]").removeClass("active"),t('[data-nav="'+page+'"]').addClass("active"),t('[data-action="select-language"]').each((function(){t(this).val(locale)}))};t(document).on("submit","[data-form]",(function(a){switch(e(a),t(this).attr("data-form")){case"search":location.href=baseurl+"/search/"+t(this).find('[name="searchtext"]').val().trim().replaceAll(" ","_");break}return!1})),t(document).on("click","[data-action]",(function(a){switch(e(a),t(this).attr("data-action")){case"scroll-to-top":t("html, body").animate({scrollTop:0},"fast");break}})),t(document).on("change","[data-action]",(function(a){switch(e(a),t(this).attr("data-action")){case"select-language":t.cookie("locale",t(this).val()),location.reload();break}})),t(document).ready((function(){t.cookie.defaults={path:"/",expires:365},navigator.geolocation.getCurrentPosition((function(t){mypos={lat:t.coords.latitude,lon:t.coords.longitude}})),locale=t.cookie("locale")||"en-US",t("html").attr("lang",locale),function(){switch((path=window.location.pathname.split("/").filter((t=>t)))[0]){case"search":o("search",{searchtext:(path[1]||"").replaceAll("_"," "),page:parseInt(path[2]||1)});break;default:o("map");break}}()})),t(document).scroll((function(){t(window).scrollTop()>200?t("body").addClass("scroll-to-top"):t("body").removeClass("scroll-to-top")}))}(jQuery);